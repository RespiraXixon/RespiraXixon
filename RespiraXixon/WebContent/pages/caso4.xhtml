<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

	<ui:composition template="/templates/plantilla.xhtml">
		<ui:define name="contenido">
			<div id="mapa">
			</div>
				<script type="text/javascript" src="../js/caso4.js"></script>
				
				<script>

				var url='http://opendata.gijon.es/descargar.php?id=1&amp;tipo=JSON';
				 
				function lee_json() {
					 var inicio,fin=0;
					 var obj_json;
					 
					 //Usamos la libreria jquery.xdomainajax.js
					 $.ajax({      
							    type: 'GET',                                                                                                                                                                                               
							    url: url,                                                                                                                                           
							    success: function(json) { 
								    //La respuesta viene con html. Dejamos el texto plano y lo parseamos
								    inicio=json.responseText.indexOf('<p>')+3;
								    fin=json.responseText.indexOf('</p>');
								    inicializa_mapa(jQuery.parseJSON(json.responseText.substring(inicio,fin).replace('\"\"','\"0\""')));
								},                                                                                                                                                                                       
							    error: function() { console.log('Error'); }							                                                                                                                                
							});			 
		        }
				lee_json();
				</script>
		</ui:define>
	</ui:composition>
</html>